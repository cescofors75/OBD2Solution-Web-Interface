
<?php

function getGroups($carid){
    global $conn;

$q = "SELECT DISTINCT prd.assemblygroupdescription as 'group'
FROM article_links
inner JOIN prd ON prd.id = article_links.productid
WHERE article_links.linkageid='$carid' and article_links.linkagetypeid='2' group by article_links.productid order by prd.assemblygroupdescription asc";


$result = $conn->query($q);

if ($result->num_rows > 0) {
    $rows = $result->fetch_all(MYSQLI_ASSOC);

    echo json_encode($rows);
} else {
    echo "no results found";
}

}


function getCats($carid,$group){
    global $conn;

$q = "SELECT DISTINCT prd.normalizeddescription as `categories`
FROM article_links
inner JOIN prd ON prd.id = article_links.productid
WHERE article_links.linkageid='$carid' and article_links.linkagetypeid='2' and prd.assemblygroupdescription = '$group' group by article_links.productid order by prd.description asc";


$result = $conn->query($q);

if ($result->num_rows > 0) {
    $rows = $result->fetch_all(MYSQLI_ASSOC);

    echo json_encode($rows);
} else {
    echo "no results found";
}

}

function getSubCats($carid,$group,$cat){
    global $conn;

$q = "SELECT DISTINCT prd.description AS `name`
FROM article_links
inner JOIN prd ON prd.id = article_links.productid
WHERE article_links.linkageid='$carid' and article_links.linkagetypeid='2' AND prd.assemblygroupdescription = '$group' AND prd.normalizeddescription = '$cat' group by article_links.productid order by prd.description asc";


$result = $conn->query($q);

if ($result->num_rows > 0) {
    $rows = $result->fetch_all(MYSQLI_ASSOC);

    echo json_encode($rows);
} else {
    echo "no results found";
}

}


function getParts($carid,$group,$cat,$subcat){
    global $conn;

$q = "SELECT DISTINCT GROUP_CONCAT(distinct manufacturers.Description,'|',REPLACE(article_oe.OENbr, ' ', '' ) ) AS parts
FROM article_links
inner JOIN article_oe ON article_oe.supplierid = article_links.supplierid AND article_oe.datasupplierarticlenumber = article_links.datasupplierarticlenumber
inner JOIN prd ON prd.id = article_links.productid
inner JOIN manufacturers ON manufacturers.id = article_oe.manufacturerId
WHERE article_links.linkageid='$carid' and article_links.linkagetypeid='2' AND prd.assemblygroupdescription = '$group' AND prd.normalizeddescription = '$cat' AND prd.description = '$subcat' group by article_links.productid order by prd.description asc";


$result = $conn->query($q);

if ($result->num_rows > 0) {
    $rows = $result->fetch_all(MYSQLI_ASSOC);

    echo json_encode($rows);
} else {
    echo "no results found";
}

}

 ?>